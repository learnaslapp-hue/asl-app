import{a as le,b as ce,r as ue}from"./chunk-3BFOI2QZ.js";import{a as me,b as de}from"./chunk-K3RRVMZ6.js";import"./chunk-FUHXKBJ3.js";import"./chunk-QUJFQN2Y.js";import"./chunk-64PZ3OSN.js";import"./chunk-JHV7MXM5.js";import"./chunk-7ISF44PN.js";import"./chunk-DHGKAU6G.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-WKYNZQQQ.js";import"./chunk-GGIMTWXW.js";import"./chunk-YPOD3FIG.js";import"./chunk-KFC3XH7K.js";import"./chunk-A4LS7W3H.js";import"./chunk-CKP3SGE2.js";import{b as ae,d as se}from"./chunk-UAKYHZSN.js";import{$a as W,Aa as M,Ab as X,Bb as Y,Ca as R,Cb as Z,Db as ee,E as a,F as r,Fb as y,H as C,Jb as te,La as x,Ma as O,O as m,Ob as ie,Pb as oe,Qa as A,S as l,T as d,Ta as v,U as b,Ua as q,Ub as re,Va as D,Vb as ne,Wa as G,Xa as Q,Ya as H,Z as k,ba as T,bb as z,ca as P,cb as $,ea as U,fa as B,ga as N,ja as f,ka as V,la as E,oa as _,pa as j,qa as F,wa as L,yb as J,zb as K}from"./chunk-HEOIPJ2Y.js";import"./chunk-MTUXJE3Z.js";import"./chunk-RD3XSXCJ.js";import"./chunk-6NUEBUYE.js";import"./chunk-W5FUFK6T.js";import"./chunk-PLFY2CTQ.js";import"./chunk-7PW2J7O2.js";import"./chunk-QIBKRVRZ.js";import"./chunk-WWLKLYXQ.js";import"./chunk-ADUYDX2F.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-O4PCMGUI.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as I,b as S,j as s}from"./chunk-LRBG2F7K.js";var be=u=>({"no-shadow":u}),Oe=(()=>{let c=class c{constructor(t,o,e,i,pe,fe,he,ge){var w;this.fb=t,this.authService=o,this.storageService=e,this.router=i,this.toastCtrl=pe,this.loadingCtrl=fe,this.platform=he,this.scrollService=ge,this.showPassword=!1,this.form=this.fb.group({email:["",[v.required,v.email]],type:[null]}),le({arrowBack:ce});let h=this.router.getCurrentNavigation(),g=(w=h==null?void 0:h.extras)==null?void 0:w.state;if(console.log(g),g){let{backUrl:n,type:p}=g;(!p||p!=="verify"&&p!=="reset"||!n||n!=="login"&&n!=="register"&&n!=="profile")&&this.router.navigateByUrl("/login",{replaceUrl:!0}),this.backUrl=n,this.form.patchValue({type:p},{emitEvent:!1})}else this.router.navigateByUrl("/login",{replaceUrl:!0});this.backSub=this.platform.backButton.subscribeWithPriority(10,()=>s(this,null,function*(){var n;(n=this.sendVerificationSub)==null||n.unsubscribe(),this.router.navigateByUrl("/"+this.backUrl,{replaceUrl:!0})}))}ionViewWillLeave(){var t;(t=this.backSub)==null||t.unsubscribe(),this.backSub=void 0}ngOnInit(){}ngAfterViewInit(){this.scrollService.register(this.content)}ngOnDestroy(){var t,o;(t=this.sendVerificationSub)==null||t.unsubscribe(),(o=this.backSub)==null||o.unsubscribe()}onSubmit(){return s(this,null,function*(){if(this.form.invalid){this.form.markAllAsTouched(),this.showToast("Please fill in valid credentials.");return}let t=yield this.loadingCtrl.create({message:"Processing...",spinner:"circles"});yield t.present();let{email:o,type:e}=this.form.value;this.sendVerificationSub=this.authService.sendVerification({email:o,type:e}).subscribe(i=>s(this,null,function*(){console.log("Send verification response",i.data),i.success?(yield t.dismiss(),this.router.navigate(["/otp"],{replaceUrl:!0,state:S(I({},i.data),{type:e,backUrl:this.backUrl})})):(yield t.dismiss(),i!=null&&i.message.toLowerCase().includes("user not found")&&this.form.controls.email.setErrors({userNotFound:!0}),this.showToast((i==null?void 0:i.message)||"Login failed."))}),i=>s(this,null,function*(){yield t.dismiss(),this.showToast((i==null?void 0:i.message)||"Login failed.")}))})}onForgotPassword(){return s(this,null,function*(){var o;let t=((o=this.form.controls.email)==null?void 0:o.value)||"";this.authService.forgotPassword(t).subscribe({next:()=>this.showToast("If that email exists, a reset link was sent."),error:()=>this.showToast("Unable to start reset right now.")})})}goToRegister(){this.router.navigateByUrl("/register")}showToast(t){return s(this,null,function*(){yield(yield this.toastCtrl.create({message:t,duration:2200,position:"bottom"})).present()})}get email(){return this.form.get("email")}get type(){return this.form.get("type")}};c.\u0275fac=function(o){return new(o||c)(r(W),r(se),r(ae),r(x),r(de),r(me),r($),r(ue))},c.\u0275cmp=C({type:c,selectors:[["app-send-verification"]],viewQuery:function(o,e){if(o&1&&U(y,7),o&2){let i;B(i=N())&&(e.content=i.first)}},decls:20,vars:13,consts:[[3,"ngClass"],[1,"transparent-toolbar"],["slot","start"],["fill","clear",3,"routerLink"],["slot","icon-only","name","arrow-back"],[1,"ion-padding","page",3,"fullscreen"],[1,"wrap"],[1,"card","no-shadow"],[3,"ngSubmit","formGroup"],["formControlName","email","label","Email","labelPlacement","stacked","fill","outline","inputmode","email","placeholder","you@example.com","clearInput","true",1,"mb",3,"errorText"],["expand","block","type","submit",1,"regular",3,"disabled"]],template:function(o,e){o&1&&(l(0,"ion-header",0),j(1,"async"),l(2,"ion-toolbar",1)(3,"ion-buttons",2)(4,"ion-button",3),b(5,"ion-icon",4),d()(),l(6,"ion-title",2),f(7),d()()(),l(8,"ion-content",5)(9,"div",6)(10,"ion-card",7)(11,"ion-card-header")(12,"ion-card-subtitle"),f(13),d()(),l(14,"ion-card-content")(15,"form",8),k("ngSubmit",function(){return e.onSubmit()}),b(16,"ion-input",9)(17,"br"),l(18,"ion-button",10),f(19," Send email verification "),d()()()()()()),o&2&&(m("ngClass",_(11,be,F(1,9,e.scrollService.scrollTop$)===0)),a(4),P("routerLink","/",e.backUrl,""),a(3),V((e.type==null?null:e.type.value)==="verfiy"?"Send email verification":"Reset password"),a(),m("fullscreen",!0),a(5),E(" ",(e.type==null?null:e.type.value)==="verfiy"?"Click the button below to send a verification email to your registered email address.":"Click the button below to send a password reset link to your registered email address."," "),a(2),m("formGroup",e.form),a(),T("errorText",e.email!=null&&e.email.hasError("required")?"Email is required":e.email!=null&&e.email.hasError("userNotFound")?"No account found with this email":""),a(2),m("disabled",e.form.invalid))},dependencies:[R,L,M,z,G,q,D,Q,H,A,O,y,te,ie,oe,X,Z,ee,Y,ne,J,K,re],styles:[".page[_ngcontent-%COMP%]{--background: var(--ion-color-primary-contrast)}.wrap[_ngcontent-%COMP%]{min-height:100%;display:flex;align-items:center;justify-content:center}.card[_ngcontent-%COMP%]{width:100%;max-width:400px;margin:0!important}ion-card-subtitle[_ngcontent-%COMP%]{font-size:16px!important}"]});let u=c;return u})();export{Oe as SendVerificationPage};
