import{a as nt,b as at}from"./chunk-S52CO7LW.js";import{a as st}from"./chunk-ZHDFZB2B.js";import{b as lt,c as ct}from"./chunk-SMHH257M.js";import"./chunk-FUHXKBJ3.js";import"./chunk-QUJFQN2Y.js";import"./chunk-64PZ3OSN.js";import"./chunk-JHV7MXM5.js";import"./chunk-7ISF44PN.js";import"./chunk-DHGKAU6G.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-WKYNZQQQ.js";import"./chunk-GGIMTWXW.js";import"./chunk-YPOD3FIG.js";import"./chunk-KFC3XH7K.js";import"./chunk-A4LS7W3H.js";import"./chunk-CKP3SGE2.js";import{b as ot,g as rt}from"./chunk-7YAWXMMP.js";import{Aa as M,G as f,H as n,Ha as V,J as w,Ja as j,Lb as q,Mb as z,Nb as W,O as k,Ob as $,Pb as J,Qb as K,R as h,Tb as C,V as U,Va as x,W as r,X as l,Xb as X,Y as y,Zb as Y,_a as N,ba as S,bb as g,bc as Z,cb as F,cc as tt,db as R,fb as A,hb as D,ia as _,ib as L,ja as O,jc as et,ka as T,lb as G,lc as it,na as c,nb as H,ob as Q,sa as B,ta as P,ua as E}from"./chunk-55BITWVR.js";import"./chunk-MTUXJE3Z.js";import"./chunk-RD3XSXCJ.js";import"./chunk-6NUEBUYE.js";import"./chunk-W5FUFK6T.js";import"./chunk-PLFY2CTQ.js";import"./chunk-7PW2J7O2.js";import"./chunk-QIBKRVRZ.js";import"./chunk-WWLKLYXQ.js";import"./chunk-ADUYDX2F.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-O4PCMGUI.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{j as p}from"./chunk-LRBG2F7K.js";var ft=a=>({"no-shadow":a});function ht(a,s){a&1&&(r(0,"ion-note",11),c(1,"Invalid OTP"),l())}var xt=(()=>{let s=class s{constructor(t,i,o,e,mt,pt,ut,dt){var I;this.fb=t,this.authService=i,this.storageService=o,this.router=e,this.toastCtrl=mt,this.loadingCtrl=pt,this.platform=ut,this.scrollService=dt,this.showPassword=!1,this.form=this.fb.group({email:["",[g.required,g.email]],otp:[null,[g.required]]}),this.backSub=this.platform.backButton.subscribeWithPriority(10,()=>p(this,null,function*(){var m;(m=this.verifySub)==null||m.unsubscribe(),this.router.navigateByUrl("/landing-page",{replaceUrl:!0})})),nt({arrowBack:at});let b=this.router.getCurrentNavigation(),v=(I=b==null?void 0:b.extras)==null?void 0:I.state;if(console.log(v),v){let{email:m,type:u,backUrl:d}=v;(!m||m.length===0||!u||u!=="verify"&&u!=="reset"||!d||d!=="login"&&d!=="register"&&d!=="profile")&&this.router.navigateByUrl("/login",{replaceUrl:!0}),u==="reset"?this.backUrl="send-verification":this.backUrl=d,this.type=u,this.form.patchValue({email:m},{emitEvent:!1})}else this.router.navigateByUrl("/login",{replaceUrl:!0})}ionViewWillLeave(){var t;(t=this.backSub)==null||t.unsubscribe(),this.backSub=void 0}ngOnInit(){}ngAfterViewInit(){this.scrollService.register(this.content)}ngOnDestroy(){var t,i;(t=this.verifySub)==null||t.unsubscribe(),(i=this.backSub)==null||i.unsubscribe()}onSubmit(){return p(this,null,function*(){if(this.form.invalid){this.form.markAllAsTouched(),this.showToast("Please fill in valid credentials.");return}let t=yield this.loadingCtrl.create({message:"Verifying...",spinner:"circles"});yield t.present();let{email:i,otp:o}=this.form.value;this.verifySub=this.authService.verify({email:i,otp:o}).subscribe(e=>p(this,null,function*(){console.log("Verification response",e.data),yield t.dismiss(),e.success?this.type==="reset"?this.router.navigate(["/reset-password"],{replaceUrl:!0,state:{email:i,hashOtp:e.data.hashOtp,backUrl:this.backUrl}}):this.router.navigateByUrl("/login",{replaceUrl:!0}):(e!=null&&e.message.toLowerCase().includes("invalid otp")&&this.form.controls.otp.setErrors({invalidOtp:!0}),this.showToast((e==null?void 0:e.message)||"Login failed."))}),e=>p(this,null,function*(){yield t.dismiss(),this.showToast((e==null?void 0:e.message)||"Login failed.")}))})}onBackHandler(){let t={type:this.type,backUrl:null};this.type==="reset"?t.backUrl="login":t.backUrl="register",this.router.navigate(["/"+this.backUrl],{replaceUrl:!0,state:t})}goToRegister(){this.router.navigateByUrl("/register")}showToast(t){return p(this,null,function*(){yield(yield this.toastCtrl.create({message:t,duration:2200,position:"bottom"})).present()})}get email(){return this.form.get("email")}get otp(){return this.form.get("otp")}};s.\u0275fac=function(i){return new(i||s)(n(G),n(rt),n(ot),n(x),n(ct),n(lt),n(Q),n(st))},s.\u0275cmp=w({type:s,selectors:[["app-otp"]],viewQuery:function(i,o){if(i&1&&_(C,7),i&2){let e;O(e=T())&&(o.content=e.first)}},decls:24,vars:9,consts:[[3,"ngClass"],[1,"transparent-toolbar"],["slot","start"],["fill","clear",3,"click"],["slot","icon-only","name","arrow-back"],[1,"ion-padding","page",3,"fullscreen"],[1,"wrap"],[1,"card","no-shadow"],[3,"ngSubmit","formGroup"],["formControlName","otp","length","6"],["href","#"],["color","danger"],["expand","block","type","submit",1,"regular",3,"disabled"]],template:function(i,o){i&1&&(r(0,"ion-header",0),P(1,"async"),r(2,"ion-toolbar",1)(3,"ion-buttons",2)(4,"ion-button",3),S("click",function(){return o.onBackHandler()}),y(5,"ion-icon",4),l()(),r(6,"ion-title",2),c(7,"Verify"),l()()(),r(8,"ion-content",5)(9,"div",6)(10,"ion-card",7)(11,"ion-card-header")(12,"ion-card-subtitle"),c(13,"Enter the 6-digit code we sent to your email to continue"),l()(),r(14,"ion-card-content")(15,"form",8),S("ngSubmit",function(){return o.onSubmit()}),r(16,"ion-input-otp",9),c(17," Didn't get a code? "),r(18,"a",10),c(19,"Resend the code"),l()(),k(20,ht,2,0,"ion-note",11),y(21,"br"),r(22,"ion-button",12),c(23," Verify "),l()()()()()()),i&2&&(h("ngClass",B(7,ft,E(1,5,o.scrollService.scrollTop$)===0)),f(8),h("fullscreen",!0),f(7),h("formGroup",o.form),f(5),U(o.otp!=null&&o.otp.hasError("invalidOtp")?20:-1),f(2),h("disabled",o.form.invalid))},dependencies:[j,M,V,H,A,F,R,D,L,N,C,X,Z,tt,W,J,K,$,q,z,et,it,Y],styles:[".page[_ngcontent-%COMP%]{--background: var(--ion-color-primary-contrast)}.wrap[_ngcontent-%COMP%]{min-height:100%;display:flex;align-items:center;justify-content:center}.card[_ngcontent-%COMP%]{width:100%;max-width:400px;margin:0!important}.input-otp-description[_ngcontent-%COMP%]{font-size:1.2rem}ion-card-subtitle[_ngcontent-%COMP%]{font-size:16px!important}"]});let a=s;return a})();export{xt as OtpPage};
