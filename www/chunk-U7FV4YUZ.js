import{a as Ee,b as Le,h as Ne,i as Oe}from"./chunk-S52CO7LW.js";import{a as Be}from"./chunk-ZHDFZB2B.js";import{b as Fe,c as je}from"./chunk-SMHH257M.js";import"./chunk-FUHXKBJ3.js";import"./chunk-QUJFQN2Y.js";import"./chunk-64PZ3OSN.js";import"./chunk-JHV7MXM5.js";import"./chunk-7ISF44PN.js";import"./chunk-DHGKAU6G.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-WKYNZQQQ.js";import"./chunk-GGIMTWXW.js";import"./chunk-YPOD3FIG.js";import"./chunk-KFC3XH7K.js";import"./chunk-A4LS7W3H.js";import"./chunk-CKP3SGE2.js";import{b as _e,g as Te}from"./chunk-7YAWXMMP.js";import{Aa as Z,G as d,H as a,Ha as ee,J as W,Ja as te,Lb as pe,Mb as ge,Nb as he,Ob as fe,Pb as be,Qb as we,R as c,Rb as ve,Tb as I,Va as ie,W as n,Wa as oe,X as l,Xb as ye,Y as m,_a as re,ac as Se,ba as v,bb as y,bc as Ie,cb as ne,cc as Ce,db as ae,fa as S,fb as se,hb as le,ia as H,ib as de,ja as Y,jc as Pe,ka as $,kc as ke,lb as ce,na as p,nb as ue,ob as me,sa as J,ta as K,ua as X}from"./chunk-55BITWVR.js";import"./chunk-MTUXJE3Z.js";import"./chunk-RD3XSXCJ.js";import"./chunk-6NUEBUYE.js";import"./chunk-W5FUFK6T.js";import"./chunk-PLFY2CTQ.js";import"./chunk-7PW2J7O2.js";import"./chunk-QIBKRVRZ.js";import"./chunk-WWLKLYXQ.js";import"./chunk-ADUYDX2F.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-O4PCMGUI.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{j as s}from"./chunk-LRBG2F7K.js";var Me=g=>({"no-shadow":g}),tt=(()=>{let u=class u{constructor(i,o,t,r,e,f,b,w){this.fb=i,this.authService=o,this.storageService=t,this.router=r,this.toastCtrl=e,this.loadingCtrl=f,this.platform=b,this.scrollService=w,this.showPassword=!1,this.form=this.fb.group({email:["",[y.required,y.email]],password:[null,[y.required]]}),this.backSub=this.platform.backButton.subscribeWithPriority(10,()=>s(this,null,function*(){var h;(h=this.loginSub)==null||h.unsubscribe(),this.router.navigateByUrl("/landing-page",{replaceUrl:!0})})),Ee({eye:Ne,eyeOff:Oe,arrowBack:Le})}ngOnInit(){}ngAfterViewInit(){this.scrollService.register(this.content)}ionViewWillLeave(){var i;(i=this.backSub)==null||i.unsubscribe(),this.backSub=void 0}ngOnDestroy(){var i,o;(i=this.loginSub)==null||i.unsubscribe(),(o=this.backSub)==null||o.unsubscribe()}onSubmit(){return s(this,null,function*(){var r;if((r=this.loginSub)==null||r.unsubscribe(),this.form.invalid){this.form.markAllAsTouched(),this.showToast("Please fill in valid credentials.");return}let i=yield this.loadingCtrl.create({message:"Signing in\u2026",spinner:"circles"});yield i.present();let{email:o,password:t}=this.form.value;this.loginSub=this.authService.login({email:o,password:t}).subscribe(e=>s(this,null,function*(){var f,b,w,h,C,P,k,_,T,E,L,N,O,B,F,j,M,q,U,x,R,V,A,z,D,G,Q;console.log("Login response",e.data),e.success?(e.data.progress={alphabet:{lastOpened:(w=(b=(f=e.data)==null?void 0:f.progress)==null?void 0:b.alphabet)==null?void 0:w.lastOpened,compeleted:((P=(C=(h=e.data)==null?void 0:h.progress)==null?void 0:C.alphabet)==null?void 0:P.compeleted)||[],status:((T=(_=(k=e.data)==null?void 0:k.progress)==null?void 0:_.alphabet)==null?void 0:T.status)||"0%"},lessons:{lastOpened:(N=(L=(E=e.data)==null?void 0:E.progress)==null?void 0:L.alphabet)==null?void 0:N.lastOpened,compeleted:((F=(B=(O=e.data)==null?void 0:O.progress)==null?void 0:B.alphabet)==null?void 0:F.compeleted)||[],status:((q=(M=(j=e.data)==null?void 0:j.progress)==null?void 0:M.alphabet)==null?void 0:q.status)||"0%"},quiz:{lastOpened:(R=(x=(U=e.data)==null?void 0:U.progress)==null?void 0:x.alphabet)==null?void 0:R.lastOpened,compeleted:((z=(A=(V=e.data)==null?void 0:V.progress)==null?void 0:A.alphabet)==null?void 0:z.compeleted)||[],status:((Q=(G=(D=e.data)==null?void 0:D.progress)==null?void 0:G.alphabet)==null?void 0:Q.status)||"0%"}},this.storageService.saveProfile(e.data).then(()=>s(this,null,function*(){this.authService.setCurrentLogin(e.data),yield i.dismiss(),this.router.navigateByUrl("/home",{replaceUrl:!0})}))):(yield i.dismiss(),e!=null&&e.message.toLowerCase().includes("user not found")&&this.form.controls.email.setErrors({userNotFound:!0}),e!=null&&e.message.toLowerCase().includes("password incorrect")&&this.form.controls.password.setErrors({passwordIncorrect:!0}),e!=null&&e.message.toLowerCase().includes("user is not verified")&&this.router.navigate(["/otp"],{replaceUrl:!0,state:{email:o,type:"verify"}}),this.showToast((e==null?void 0:e.message)||"Login failed."))}),e=>s(this,null,function*(){yield i.dismiss(),this.showToast((e==null?void 0:e.message)||"Login failed.")}))})}onForgotPassword(){return s(this,null,function*(){this.router.navigate(["/send-verification"],{replaceUrl:!0,state:{type:"reset",backUrl:"login"}})})}goToRegister(){this.router.navigateByUrl("/register")}showToast(i){return s(this,null,function*(){yield(yield this.toastCtrl.create({message:i,duration:2200,position:"bottom"})).present()})}get email(){return this.form.get("email")}get password(){return this.form.get("password")}};u.\u0275fac=function(o){return new(o||u)(a(ce),a(Te),a(_e),a(ie),a(je),a(Fe),a(me),a(Be))},u.\u0275cmp=W({type:u,selectors:[["app-login"]],viewQuery:function(o,t){if(o&1&&H(I,7),o&2){let r;Y(r=$())&&(t.content=r.first)}},decls:30,vars:13,consts:[[3,"ngClass"],[1,"transparent-toolbar","no-shadow"],["slot","start"],["routerLink","/landing-page","fill","clear"],["slot","icon-only","name","arrow-back"],[1,"ion-padding","page",3,"fullscreen","scrollEvents"],[1,"wrap"],[1,"card","no-shadow"],[3,"ngSubmit","formGroup"],["formControlName","email","label","Email","labelPlacement","stacked","fill","outline","inputmode","email","placeholder","you@example.com","clearInput","true",1,"mb",3,"errorText"],["formControlName","password","label","Password","placeholder","Enter your password","labelPlacement","stacked","fill","outline","autocomplete","off",1,"mb",3,"errorText","type"],["slot","end","fill","clear","size","small","type","button",3,"click"],[3,"name"],[2,"display","flex","flex-direction","column","align-items","flex-end","font-size","16px"],["color","primary",3,"click"],["expand","block","type","submit",1,"regular",3,"disabled"]],template:function(o,t){o&1&&(n(0,"ion-header",0),K(1,"async"),n(2,"ion-toolbar",1)(3,"ion-buttons",2)(4,"ion-button",3),m(5,"ion-icon",4),l()(),n(6,"ion-title",2),p(7,"Sign in"),l()()(),n(8,"ion-content",5)(9,"div",6)(10,"ion-card",7)(11,"ion-card-header")(12,"ion-card-title"),p(13,"Welcome back"),l(),n(14,"ion-card-subtitle"),p(15,"Sign in to continue"),l()(),n(16,"ion-card-content")(17,"form",8),v("ngSubmit",function(){return t.onSubmit()}),m(18,"ion-input",9)(19,"br"),n(20,"ion-input",10)(21,"ion-button",11),v("click",function(){return t.showPassword=!t.showPassword}),m(22,"ion-icon",12),l()(),m(23,"br"),n(24,"div",13)(25,"ion-text",14),v("click",function(){return t.onForgotPassword()}),p(26,"Forgot password?"),l()(),m(27,"br"),n(28,"ion-button",15),p(29," Sign in "),l()()()()()()),o&2&&(c("ngClass",J(11,Me,X(1,9,t.scrollService.scrollTop$)===0)),d(8),c("fullscreen",!0)("scrollEvents",!0),d(9),c("formGroup",t.form),d(),S("errorText",t.email!=null&&t.email.hasError("required")?"Email is required":t.email!=null&&t.email.hasError("userNotVerified")?"Your email is not verified. Please check your inbox.":t.email!=null&&t.email.hasError("userNotFound")?"No account found with this email":""),d(2),S("errorText",t.password!=null&&t.password.hasError("required")?"Password is required":t.password!=null&&t.password.hasError("passwordIncorrect")?"Password is incorrect":""),c("type",t.showPassword?"text":"password"),d(2),c("name",t.showPassword?"eye-off":"eye"),d(6),c("disabled",t.form.invalid))},dependencies:[te,Z,ee,ue,se,ne,ae,le,de,re,oe,I,ye,Ie,Ce,he,be,ve,we,fe,ke,pe,ge,Pe,Se],styles:[".page[_ngcontent-%COMP%]{--background: var(--ion-color-primary-contrast)}.wrap[_ngcontent-%COMP%]{min-height:100%;display:flex;align-items:center;justify-content:center}.card[_ngcontent-%COMP%]{width:100%;max-width:400px;margin:0!important}ion-card-subtitle[_ngcontent-%COMP%]{font-size:16px!important}"]});let g=u;return g})();export{tt as LoginPage};
