import{a as be,b as K}from"./chunk-O57VFSZL.js";import{a as we,b as xe,e as Ie,m as Me,r as X}from"./chunk-3BFOI2QZ.js";import{a as I,b as J}from"./chunk-S5ULKTYV.js";import"./chunk-3NTGT44D.js";import{b as q,c as Pe,d as Se}from"./chunk-UAKYHZSN.js";import{Aa as ge,Ab as fe,Bb as Ce,C as E,Ca as D,E as s,Eb as ve,F as f,Fb as T,H as O,Ia as L,Ib as $,Ja as pe,Jb as A,L as h,Mb as ye,O as _,Ob as Q,P as le,Pb as U,Qa as ue,Qb as W,R as G,S as c,T as l,U as g,Ub as H,V as y,W as P,Y as w,Z as S,_ as d,ab as N,ba as se,e as ae,ea as V,fa as B,ga as F,ha as Y,ia as Z,j as ce,ja as C,ka as x,la as ee,oa as de,pa as te,qa as ne,r as b,sa as ie,u as p,v as u,wa as _e,wb as he,xa as me,ya as j,yb as R,zb as z}from"./chunk-HEOIPJ2Y.js";import"./chunk-MTUXJE3Z.js";import"./chunk-PLFY2CTQ.js";import"./chunk-7PW2J7O2.js";import"./chunk-QIBKRVRZ.js";import"./chunk-WWLKLYXQ.js";import"./chunk-ADUYDX2F.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-O4PCMGUI.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{j as M}from"./chunk-LRBG2F7K.js";var je=["vid"];function De(i,a){i&1&&(c(0,"div",12),g(1,"ion-spinner",13),l())}var Te=(()=>{let a=class a{constructor(n,e,o,r,m){this.scrollService=n,this.statusBarService=e,this.storageService=o,this.authService=r,this.modalCtrl=m,this.san=b(L),this.loading=!0,this.duration=0,this.watchedSeconds=[],this.lastTime=0,this.lastContinuousStart=0,this.seeking=!1,this.completionFired=!1,this.CONT_END_TAIL=1,this.CONT_REQUIRED=5,this.MAX_JUMP_FOR_CONT=1.25}ngOnInit(){var n;if((n=this.item)!=null&&n.video){let e=`${Pe.apiBaseUrl}/video/${this.item.video}`;this.safeSrc=this.san.bypassSecurityTrustResourceUrl(e)}}ionViewWillEnter(){this.initializeStatusBar()}ionViewWillLeave(){this.statusBarService.modifyStatusBar(I.Light)}onLoadStart(){this.loading=!0}onCanPlay(){var n,e;this.loading=!1,(e=(n=this.vid)==null?void 0:n.nativeElement)==null||e.play().catch(()=>{})}onError(n){this.loading=!1,console.error("video error",n)}close(){return M(this,null,function*(){let n=yield this.modalCtrl.getTop();yield n==null?void 0:n.dismiss({})})}onMeta(){var o;let n=(o=this.vid)==null?void 0:o.nativeElement;if(!n)return;this.duration=Number.isFinite(n.duration)?n.duration:0;let e=Math.max(1,Math.ceil(this.duration||0));this.watchedSeconds=new Array(e).fill(!1),this.lastTime=0,this.lastContinuousStart=0,this.completionFired=!1}onTimeUpdate(){var v;let n=(v=this.vid)==null?void 0:v.nativeElement;if(!n||!this.duration)return;let e=n.currentTime,o=Math.floor(e);o>=0&&o<this.watchedSeconds.length&&(this.watchedSeconds[o]=!0),!this.completionFired&&e<this.lastTime&&this.lastTime>=this.duration-this.CONT_END_TAIL&&this.markAttemptedEnd("loop-wrap"),(Math.abs(e-this.lastTime)>this.MAX_JUMP_FOR_CONT||this.seeking)&&(this.lastContinuousStart=e);let r=e>=this.duration-this.CONT_END_TAIL,m=e-this.lastContinuousStart;!this.completionFired&&r&&m>=this.CONT_REQUIRED&&this.markAttemptedEnd("tail-reached-continuous"),this.lastTime=e}onSeeking(){this.seeking=!0}onSeeked(){var e;let n=(e=this.vid)==null?void 0:e.nativeElement;this.seeking=!1,n&&(this.lastContinuousStart=n.currentTime)}onRateChange(){var e,o,r;((r=(o=(e=this.vid)==null?void 0:e.nativeElement)==null?void 0:o.playbackRate)!=null?r:1)>2&&!this.completionFired&&(this.lastContinuousStart=this.vid.nativeElement.currentTime)}onEnded(){this.completionFired||this.markAttemptedEnd("native-ended")}markAttemptedEnd(n){var o,r;this.completionFired=!0;let e={itemId:(r=(o=this.item)==null?void 0:o.video)!=null?r:null,reason:n,duration:this.duration,watchedPercent:this.watchedPercent(),watchedSeconds:this.countWatchedSeconds(),timestamp:Date.now()};console.log("Video completion (attempt) logged:",e),this.logCompleted()}watchedPercent(){if(!this.duration||!this.watchedSeconds.length)return 0;let n=this.watchedSeconds.reduce((e,o)=>e+(o?1:0),0);return Math.min(100,n/this.watchedSeconds.length*100)}countWatchedSeconds(){return this.watchedSeconds.reduce((n,e)=>n+(e?1:0),0)}initializeStatusBar(){this.statusBarService.show(!0),this.statusBarService.modifyStatusBar(I.Dark),this.statusBarService.overLay(!1)}logCompleted(){var o,r,m,v,k,oe,re;let n=be((o=this.category)==null?void 0:o.slug,(r=this.item)==null?void 0:r.slug),e=(k=((v=(m=this.currentProfile)==null?void 0:m.progress)==null?void 0:v.lessons).compeleted)!=null?k:[];e.includes(n)||e.push(n),((re=(oe=this.currentProfile)==null?void 0:oe.progress)==null?void 0:re.lessons).compeleted=e,this.storageService.saveProfile(this.currentProfile),this.authService.setCurrentLogin(this.currentProfile)}};a.\u0275fac=function(e){return new(e||a)(f(X),f(J),f(q),f(Se),f(W))},a.\u0275cmp=O({type:a,selectors:[["app-video-player"]],viewQuery:function(e,o){if(e&1&&V(je,7),e&2){let r;B(r=F())&&(o.vid=r.first)}},decls:13,vars:7,consts:[["vid",""],[3,"translucent"],["color","dark"],["slot","start"],[3,"click"],["name","arrow-back","slot","icon-only"],[2,"text-align","center"],["slot","end",2,"width","48px"],[1,"viewer",3,"fullscreen"],["class","overlay",4,"ngIf"],["autoplay","","muted","","playsinline","","preload","auto","loop","","poster","",1,"player",3,"loadstart","loadedmetadata","canplay","playing","timeupdate","seeking","seeked","ratechange","ended","error","src"],[1,"no-shadow","modal-safe-botom"],[1,"overlay"],["name","crescent","color","light",2,"width","80px","height","80px"]],template:function(e,o){if(e&1){let r=w();c(0,"ion-header",1)(1,"ion-toolbar",2)(2,"ion-buttons",3)(3,"ion-button",4),S("click",function(){return p(r),u(o.close())}),g(4,"ion-icon",5),l()(),c(5,"ion-title",6),C(6),l(),g(7,"div",7),l()(),c(8,"ion-content",8),h(9,De,2,0,"div",9),c(10,"video",10,0),S("loadstart",function(){return p(r),u(o.onLoadStart())})("loadedmetadata",function(){return p(r),u(o.onMeta())})("canplay",function(){return p(r),u(o.onCanPlay())})("playing",function(){return p(r),u(o.onCanPlay())})("timeupdate",function(){return p(r),u(o.onTimeUpdate())})("seeking",function(){return p(r),u(o.onSeeking())})("seeked",function(){return p(r),u(o.onSeeked())})("ratechange",function(){return p(r),u(o.onRateChange())})("ended",function(){return p(r),u(o.onEnded())})("error",function(v){return p(r),u(o.onError(v))}),l()(),g(12,"ion-footer",11)}e&2&&(_("translucent",!0),s(6),x(o.item==null?null:o.item.name),s(2),_("fullscreen",!0),s(),_("ngIf",o.loading),s(),le("opacity",o.loading?0:1),_("src",o.safeSrc,E))},dependencies:[T,A,Q,U,D,j,N,z,R,H,ye,$],styles:[".viewer[_ngcontent-%COMP%]{--background: #000;background:#000}.player[_ngcontent-%COMP%]{width:100%;height:100%;display:block;background:#000;object-fit:contain;transition:opacity .16s ease-in;opacity:0;-webkit-tap-highlight-color:transparent}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;right:0;bottom:0;left:0;display:grid;place-items:center;background:#000}ion-footer[_ngcontent-%COMP%]{background:#000}"]});let i=a;return i})();var Le=i=>({"no-shadow":i});function Ne(i,a){if(i&1&&(y(0),C(1),P()),i&2){let t=a.ngIf;s(),x(t.category)}}function Re(i,a){i&1&&g(0,"ion-icon",18)}function ze(i,a){if(i&1){let t=w();y(0),c(1,"div",11),S("click",function(){let e=p(t).$implicit,o=d(3).ngIf,r=d();return u(r.onShowVideoPlayer(e,o))}),c(2,"ion-card"),g(3,"img",12),l(),c(4,"div",13)(5,"h4",14),C(6),l(),c(7,"ion-button",15),g(8,"ion-icon",16),l()(),h(9,Re,1,0,"ion-icon",17),l(),P()}if(i&2){let t=a.$implicit,n=d(3).ngIf,e=d();s(3),se("alt",t.name),_("src",t.image,E),s(3),x(t.name),s(3),_("ngIf",e.isItemDone(n.slug,t.slug))}}function $e(i,a){if(i&1&&(c(0,"div",8),h(1,ze,10,4,"ng-container",10),l()),i&2){let t=d(2).ngIf;s(),_("ngForOf",t.items)}}function Ae(i,a){i&1&&g(0,"ion-icon",18)}function Qe(i,a){if(i&1){let t=w();y(0),c(1,"div",11),S("click",function(){let e=p(t).$implicit,o=d(3).ngIf,r=d();return u(r.onShowVideoPlayer(e,o))}),c(2,"ion-card")(3,"ion-card-content")(4,"ion-card-title"),C(5),h(6,Ae,1,0,"ion-icon",17),l(),c(7,"ion-button",15),g(8,"ion-icon",16),l()()()(),P()}if(i&2){let t=a.$implicit,n=d(3).ngIf,e=d();s(5),ee("",t.name," "),s(),_("ngIf",e.isItemDone(n.slug,t.slug))}}function Ue(i,a){if(i&1&&(c(0,"div",9),h(1,Qe,9,2,"ng-container",10),l()),i&2){let t=d(2).ngIf;s(),_("ngForOf",t.items)}}function We(i,a){if(i&1&&g(0,"ion-icon",22),i&2){let t=d().$implicit;_("color",(t==null?null:t.slug)!=="white"?"light":"dark")}}function He(i,a){i&1&&(c(0,"ion-button",20),g(1,"ion-icon",16),l())}function qe(i,a){i&1&&(c(0,"ion-button",21),g(1,"ion-icon",16),l())}function Je(i,a){if(i&1){let t=w();y(0),c(1,"div",11),S("click",function(){let e=p(t).$implicit,o=d(3).ngIf,r=d();return u(r.onShowVideoPlayer(e,o))}),c(2,"ion-card")(3,"ion-card-content")(4,"ion-card-title"),C(5),h(6,We,1,1,"ion-icon",19),l(),h(7,He,2,0,"ion-button",20)(8,qe,2,0,"ion-button",21),l()()(),P()}if(i&2){let t=a.$implicit,n=d(3).ngIf,e=d();s(3),Z("background-color: ",t.backgroundColor,";"),s(),Z("color: ",t.fontColor,";"),s(),ee("",t.name," "),s(),_("ngIf",e.isItemDone(n.slug,t.slug)),s(),G((t==null?null:t.slug)!=="white"?7:8)}}function Xe(i,a){if(i&1&&(c(0,"div",9),h(1,Je,9,9,"ng-container",10),l()),i&2){let t=d(2).ngIf;s(),_("ngForOf",t.items)}}function Ke(i,a){i&1&&g(0,"ion-icon",18)}function Ge(i,a){if(i&1){let t=w();y(0),c(1,"div",11),S("click",function(){let e=p(t).$implicit,o=d(3).ngIf,r=d();return u(r.onShowVideoPlayer(e,o))}),c(2,"ion-card")(3,"ion-card-content")(4,"span",23),C(5),l(),h(6,Ke,1,0,"ion-icon",17),l()(),c(7,"div",24)(8,"h4",14),C(9),l(),c(10,"ion-button",15),g(11,"ion-icon",16),l()()(),P()}if(i&2){let t=a.$implicit,n=d(3).ngIf,e=d();s(5),x(t==null?null:t.content),s(),_("ngIf",e.isItemDone(n.slug,t.slug)),s(3),x(t.name)}}function Ye(i,a){if(i&1&&(c(0,"div",8),h(1,Ge,12,3,"ng-container",10),l()),i&2){let t=d(2).ngIf;s(),_("ngForOf",t.items)}}function Ze(i,a){if(i&1&&(y(0),h(1,$e,2,1,"div",8)(2,Ue,2,1,"div",9)(3,Xe,2,1,"div",9)(4,Ye,2,1,"div",8),P()),i&2){let t=d().ngIf;s(),G((t==null?null:t.slug)==="animals"?1:(t==null?null:t.slug)==="basic_words"||(t==null?null:t.slug)==="day"||(t==null?null:t.slug)==="months"||(t==null?null:t.slug)==="numbers"||(t==null?null:t.slug)==="verbs"?2:(t==null?null:t.slug)==="color"?3:(t==null?null:t.slug)==="emotions"||(t==null?null:t.slug)==="places_and_directions"||(t==null?null:t.slug)==="relationships"?4:-1)}}function et(i,a){if(i&1&&(y(0),h(1,Ze,5,1,"ng-container",5),P()),i&2){let t=a.ngIf;d();let n=Y(13);s(),_("ngIf",t==null||t.items==null?null:t.items.length)("ngIfElse",n)}}function tt(i,a){i&1&&(c(0,"p"),C(1,"Loading\u2026"),l())}function nt(i,a){i&1&&(c(0,"p"),C(1,"No items yet for this category."),l())}var jt=(()=>{let a=class a{constructor(n,e,o,r,m,v){this.scrollService=n,this.statusBarService=e,this.storageService=o,this.lessonsService=r,this.modalCtrl=m,this.domSanitizer=v,this.route=b(pe),this.lessons=b(K),this.showShadow=!1,this.current="",we({arrowBack:xe,play:Me,checkmarkCircle:Ie}),this.scrollService.scrollTop$.subscribe(k=>this.showShadow=k>0)}ngOnInit(){return M(this,null,function*(){this.currentProfile=yield this.storageService.getSavedProfile(),this.category$=this.route.paramMap.pipe(ae(n=>n.get("category")||""),ce(n=>(this.current=n,this.lessons.getCategory(n))))})}ngAfterViewInit(){this.initializeStatusBar(),this.scrollService.register(this.content)}ionViewWillEnter(){this.initializeStatusBar()}isItemDone(n,e){return this.lessonsService.isItemDone(this.currentProfile||void 0,n,e)}onShowVideoPlayer(n,e){return M(this,null,function*(){let o=yield this.modalCtrl.create({component:Te,cssClass:"modal-fullscreen",backdropDismiss:!1,canDismiss:!0,componentProps:{item:n,category:e,currentProfile:this.currentProfile}});yield o.present(),o.onDidDismiss().then(r=>{this.statusBarService.modifyStatusBar(I.Light)})})}initializeStatusBar(){this.statusBarService.show(!0),this.statusBarService.modifyStatusBar(I.Light),this.statusBarService.overLay(!1)}};a.\u0275fac=function(e){return new(e||a)(f(X),f(J),f(q),f(K),f(W),f(L))},a.\u0275cmp=O({type:a,selectors:[["app-category"]],viewQuery:function(e,o){if(e&1&&V(T,7),e&2){let r;B(r=F())&&(o.content=r.first)}},decls:15,vars:12,consts:[["loading",""],["empty",""],[3,"translucent","ngClass"],["slot","start"],["default-href","/lessons"],[4,"ngIf","ngIfElse"],[1,"ion-padding","modal-safe-botom"],[1,"no-shadow","modal-safe-botom"],[1,"cards","grid"],[1,"cards","list"],[4,"ngFor","ngForOf"],[1,"card-holder",3,"click"],[3,"src","alt"],[1,"card-action","animals"],[1,"card-title"],["shape","round"],["name","play","slot","icon-only"],["color","success","size","large","name","checkmark-circle","class","done",4,"ngIf"],["color","success","size","large","name","checkmark-circle",1,"done"],["size","large","name","checkmark-circle","class","done",3,"color",4,"ngIf"],["shape","round","color","light","fill","outline"],["shape","round","color","dark","fill","outline"],["size","large","name","checkmark-circle",1,"done",3,"color"],[1,"emoji"],[1,"card-action","emotions"]],template:function(e,o){if(e&1&&(c(0,"ion-header",2)(1,"ion-toolbar")(2,"ion-buttons",3),g(3,"ion-back-button",4),l(),c(4,"ion-title"),h(5,Ne,2,1,"ng-container",5),te(6,"async"),l()()(),c(7,"ion-content",6),h(8,et,2,2,"ng-container",5),te(9,"async"),h(10,tt,2,0,"ng-template",null,0,ie)(12,nt,2,0,"ng-template",null,1,ie),l(),g(14,"ion-footer",7)),e&2){let r=Y(11);_("translucent",!0)("ngClass",de(10,Le,!o.showShadow)),s(5),_("ngIf",ne(6,6,o.category$))("ngIfElse",r),s(3),_("ngIf",ne(9,8,o.category$))("ngIfElse",r)}},dependencies:[D,_e,me,j,ge,N,ue,T,U,z,R,H,Q,A,he,$,fe,Ce,ve],styles:[".cards[_ngcontent-%COMP%]{gap:10px}.cards.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr)}.cards.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]{text-align:center;position:relative}.cards.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{height:240px;pointer-events:none}.cards.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:0!important;display:flex;flex-direction:column;align-items:center;justify-content:center}.cards.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   .card-action[_ngcontent-%COMP%]{display:flex;justify-content:space-between;position:absolute;width:100%;padding-left:10px;padding-right:10px;align-items:center}.cards.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   .card-action.animals[_ngcontent-%COMP%]{flex-direction:row;background-color:#00000047;bottom:0;color:#fff}.cards.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   .card-action.emotions[_ngcontent-%COMP%]{flex-direction:column;top:0;height:100%;padding-bottom:10px}.cards.list[_ngcontent-%COMP%]{display:flex;flex-direction:column}.cards.list[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding-left:30px;padding-right:30px;display:flex;flex-direction:row;align-items:center;justify-content:space-between}.cards.list[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;gap:10px}.card-holder[_ngcontent-%COMP%]{width:100%;display:inline-block;transition:transform .15s ease-in-out;cursor:pointer;overflow:hidden;border-radius:12px;box-shadow:0 8px 16px #00000014,0 0 4px #0000000a!important}.card-holder[_ngcontent-%COMP%]:active{transform:scale(.95)}ion-card[_ngcontent-%COMP%]{width:100%;margin:0!important;--background: transparent;background:transparent;border:none!important;box-shadow:none}ion-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-position:center;object-fit:cover}ion-card-content[_ngcontent-%COMP%]{width:100%;height:100%}ion-card-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.card-title[_ngcontent-%COMP%]{margin-top:10px!important;margin-bottom:10px!important}.emoji[_ngcontent-%COMP%]{font-size:5rem}.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   .done[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;background:#fff;border-radius:50%}"]});let i=a;return i})();export{jt as CategoryPage};
