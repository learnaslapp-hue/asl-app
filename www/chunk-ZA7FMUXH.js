import{a as oe,b as se,h as ne,i as ae,r as le}from"./chunk-HZKMSCS6.js";import{a as ce,b as de}from"./chunk-5NPJNAPJ.js";import"./chunk-FUHXKBJ3.js";import"./chunk-QUJFQN2Y.js";import"./chunk-64PZ3OSN.js";import"./chunk-JHV7MXM5.js";import"./chunk-7ISF44PN.js";import"./chunk-DHGKAU6G.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-WKYNZQQQ.js";import"./chunk-GGIMTWXW.js";import"./chunk-YPOD3FIG.js";import"./chunk-KFC3XH7K.js";import"./chunk-A4LS7W3H.js";import"./chunk-CKP3SGE2.js";import{b as re,d as ie}from"./chunk-3T6SOJS6.js";import{Aa as O,Bb as z,Ca as M,Cb as W,Db as $,E as c,Eb as J,F as n,Fb as K,Gb as X,H as k,Ib as y,La as q,Mb as Y,O as a,Qa as j,Rb as Z,S as l,Sb as x,T as m,Ta as d,U as h,Ua as F,Va as L,Xa as V,Xb as ee,Yb as te,Z as f,Za as A,_a as D,ba as v,bb as G,db as H,ea as _,eb as Q,fa as T,ga as U,ja as g,oa as B,pa as E,qa as R,wa as N}from"./chunk-UJODM2NG.js";import"./chunk-MTUXJE3Z.js";import"./chunk-RD3XSXCJ.js";import"./chunk-6NUEBUYE.js";import"./chunk-W5FUFK6T.js";import"./chunk-PLFY2CTQ.js";import"./chunk-7PW2J7O2.js";import"./chunk-QIBKRVRZ.js";import"./chunk-WWLKLYXQ.js";import"./chunk-ADUYDX2F.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-O4PCMGUI.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{j as u}from"./chunk-LRBG2F7K.js";var he=w=>({"no-shadow":w}),je=(()=>{let p=class p{constructor(t,r,e,o,i,ue,me,pe){var S;this.fb=t,this.authService=r,this.storageService=e,this.router=o,this.toastCtrl=i,this.loadingCtrl=ue,this.platform=me,this.scrollService=pe,this.showPassword=!1,this.form=this.fb.group({email:["",[d.required,d.email]],hashOtp:["",[d.required]],newPassword:[null,[d.required,d.minLength(6)]],confirmPassword:[null,[d.required,d.minLength(6)]]}),oe({eye:ne,eyeOff:ae,arrowBack:se});let b=this.router.getCurrentNavigation(),P=(S=b==null?void 0:b.extras)==null?void 0:S.state;if(console.log(P),P){let{backUrl:s,hashOtp:C,email:I}=P;(!I||!C||!s||s!=="login"&&s!=="register"&&s!=="profile"&&s!=="send-verification")&&this.router.navigateByUrl("/login",{replaceUrl:!0}),s==="login"?this.backUrl="send-verification":this.backUrl=s,this.form.patchValue({email:I,hashOtp:C},{emitEvent:!1})}else this.router.navigateByUrl("/login",{replaceUrl:!0});this.backSub=this.platform.backButton.subscribeWithPriority(10,()=>u(this,null,function*(){var s;(s=this.resetPasswordSub)==null||s.unsubscribe(),this.router.navigateByUrl("/"+this.backUrl,{replaceUrl:!0})}))}ionViewWillLeave(){var t;(t=this.backSub)==null||t.unsubscribe(),this.backSub=void 0}ngOnInit(){this.confirmPassword.valueChanges.subscribe(t=>{t&&this.newPassword.value!==t?this.confirmPassword.setErrors({notMatching:!0}):this.confirmPassword.setErrors(null)})}ngAfterViewInit(){this.scrollService.register(this.content)}ngOnDestroy(){var t,r;(t=this.resetPasswordSub)==null||t.unsubscribe(),(r=this.backSub)==null||r.unsubscribe()}onSubmit(){return u(this,null,function*(){if(this.form.invalid){this.form.markAllAsTouched(),this.showToast("Please fill in valid credentials.");return}let t=yield this.loadingCtrl.create({message:"Saving password...",spinner:"circles"});yield t.present();let{email:r,hashOtp:e,newPassword:o}=this.form.value;this.resetPasswordSub=this.authService.resetPassword({email:r,hashOtp:e,password:o}).subscribe(i=>u(this,null,function*(){console.log("Reset password response",i.data),i.success?(yield t.dismiss(),this.showToast("Password reset successful. Please login."),this.router.navigateByUrl("/login",{replaceUrl:!0})):(yield t.dismiss(),i!=null&&i.message.toLowerCase().includes("user not found")&&this.form.controls.email.setErrors({userNotFound:!0}),i!=null&&i.message.toLowerCase().includes("please request a new otp")&&this.router.navigate(["/send-verification"],{replaceUrl:!0,state:{type:"reset",backUrl:"login"}}))}),i=>u(this,null,function*(){yield t.dismiss(),this.showToast((i==null?void 0:i.message)||"Reset password failed.")}))})}onForgotPassword(){return u(this,null,function*(){var r;let t=((r=this.form.controls.email)==null?void 0:r.value)||"";this.authService.forgotPassword(t).subscribe({next:()=>this.showToast("If that email exists, a reset link was sent."),error:()=>this.showToast("Unable to start reset right now.")})})}goToRegister(){this.router.navigateByUrl("/register")}onBackHandler(){let t;this.backUrl==="send-verification"?this.router.navigate(["/send-verification"],{replaceUrl:!0,state:{type:"reset",backUrl:"login"}}):this.router.navigate(["/"+this.backUrl],{replaceUrl:!0})}showToast(t){return u(this,null,function*(){yield(yield this.toastCtrl.create({message:t,duration:2200,position:"bottom"})).present()})}get email(){return this.form.get("email")}get hashOtp(){return this.form.get("hashOtp")}get newPassword(){return this.form.get("newPassword")}get confirmPassword(){return this.form.get("confirmPassword")}};p.\u0275fac=function(r){return new(r||p)(n(G),n(ie),n(re),n(q),n(de),n(ce),n(Q),n(le))},p.\u0275cmp=k({type:p,selectors:[["app-reset-password"]],viewQuery:function(r,e){if(r&1&&_(y,7),r&2){let o;T(o=U())&&(e.content=o.first)}},decls:26,vars:14,consts:[[3,"ngClass"],[1,"transparent-toolbar"],["slot","start"],["fill","clear",3,"click"],["slot","icon-only","name","arrow-back"],[1,"ion-padding","page",3,"fullscreen"],[1,"wrap"],[1,"card","no-shadow"],[3,"ngSubmit","formGroup"],["formControlName","newPassword","label","New Password","placeholder","Enter your new password","labelPlacement","stacked","fill","outline","autocomplete","off",1,"mb",3,"errorText","type"],["slot","end","fill","clear","size","small","type","button",3,"click"],[3,"name"],["formControlName","confirmPassword","label","Confirm Password","placeholder","Confirm your password","labelPlacement","stacked","fill","outline","autocomplete","off",1,"mb",3,"errorText","type"],["expand","block","type","submit",1,"regular",3,"disabled"]],template:function(r,e){r&1&&(l(0,"ion-header",0),E(1,"async"),l(2,"ion-toolbar",1)(3,"ion-buttons",2)(4,"ion-button",3),f("click",function(){return e.onBackHandler()}),h(5,"ion-icon",4),m()(),l(6,"ion-title",2),g(7,"Reset password"),m()()(),l(8,"ion-content",5)(9,"div",6)(10,"ion-card",7)(11,"ion-card-header")(12,"ion-card-subtitle"),g(13,"Choose a strong new password, confirm it, and you\u2019ll be ready to sign back in."),m()(),l(14,"ion-card-content")(15,"form",8),f("ngSubmit",function(){return e.onSubmit()}),l(16,"ion-input",9)(17,"ion-button",10),f("click",function(){return e.showPassword=!e.showPassword}),h(18,"ion-icon",11),m()(),h(19,"br"),l(20,"ion-input",12)(21,"ion-button",10),f("click",function(){return e.showPassword=!e.showPassword}),h(22,"ion-icon",11),m()(),h(23,"br"),l(24,"ion-button",13),g(25," Save Password "),m()()()()()()),r&2&&(a("ngClass",B(12,he,R(1,10,e.scrollService.scrollTop$)===0)),c(8),a("fullscreen",!0),c(7),a("formGroup",e.form),c(),v("errorText",e.newPassword!=null&&e.newPassword.hasError("required")?"Password is required":e.newPassword!=null&&e.newPassword.hasError("minlength")?"Password must be at least 6 characters long":""),a("type",e.showPassword?"text":"password"),c(2),a("name",e.showPassword?"eye-off":"eye"),c(2),v("errorText",e.confirmPassword!=null&&e.confirmPassword.hasError("required")?"Password is required":e.confirmPassword!=null&&e.confirmPassword.hasError("notMatching")?"Passwords do not match":""),a("type",e.showPassword?"text":"password"),c(2),a("name",e.showPassword?"eye-off":"eye"),c(2),a("disabled",e.form.invalid))},dependencies:[M,N,O,H,V,F,L,A,D,j,y,Y,Z,x,$,K,X,J,te,z,W,ee],styles:[".page[_ngcontent-%COMP%]{--background: var(--ion-color-primary-contrast)}.wrap[_ngcontent-%COMP%]{min-height:100%;display:flex;align-items:center;justify-content:center}.card[_ngcontent-%COMP%]{width:100%;max-width:400px;margin:0!important}ion-card-subtitle[_ngcontent-%COMP%]{font-size:16px!important}"]});let w=p;return w})();export{je as ResetPasswordPage};
