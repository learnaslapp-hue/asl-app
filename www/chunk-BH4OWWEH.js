import{a as Be,b as W}from"./chunk-ILYSE5R6.js";import{a as je}from"./chunk-CKJ3JQZ6.js";import{a as Oe,b as Ee,e as Te,m as Ve}from"./chunk-S52CO7LW.js";import{a as K}from"./chunk-ZHDFZB2B.js";import{a as b,b as H}from"./chunk-OO67IDCK.js";import"./chunk-3NTGT44D.js";import{b as Q,c as be,g as ke}from"./chunk-7YAWXMMP.js";import{Aa as he,Ba as fe,Ca as ye,E as ue,G as s,H as y,Ha as Ce,Ib as Se,J as E,Ja as j,Lb as D,Mb as A,Nb as xe,O as f,Ob as Ie,R as m,Rb as Me,Sa as ve,Ta as we,Tb as O,V as Z,W as c,Wb as L,X as l,Xb as R,Y as u,Z as P,_ as S,_a as Pe,aa as I,ba as x,bc as U,ca as d,cc as $,dc as z,f as de,fa as ge,ia as T,ja as V,jc as N,k as _e,ka as B,la as q,ma as ee,mb as F,na as v,o as me,oa as M,pa as te,s as Y,sa as pe,ta as ne,ua as ie,v as p,w as h,wa as oe}from"./chunk-55BITWVR.js";import"./chunk-MTUXJE3Z.js";import"./chunk-PLFY2CTQ.js";import"./chunk-7PW2J7O2.js";import"./chunk-QIBKRVRZ.js";import"./chunk-WWLKLYXQ.js";import"./chunk-ADUYDX2F.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-O4PCMGUI.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{j as C}from"./chunk-LRBG2F7K.js";function G(i){return new Promise((a,n)=>{i.oncomplete=i.onsuccess=()=>a(i.result),i.onabort=i.onerror=()=>n(i.error)})}function Re(i,a){let n,t=()=>{if(n)return n;let e=indexedDB.open(i);return e.onupgradeneeded=()=>e.result.createObjectStore(a),n=G(e),n.then(o=>{o.onclose=()=>n=void 0},()=>{}),n};return(e,o)=>t().then(r=>o(r.transaction(a,e).objectStore(a)))}var re;function ae(){return re||(re=Re("keyval-store","keyval")),re}function ce(i,a=ae()){return a("readonly",n=>G(n.get(i)))}function le(i,a,n=ae()){return n("readwrite",t=>(t.put(a,i),G(t.transaction)))}function se(i,a=ae()){return a("readwrite",n=>(n.delete(i),G(n.transaction)))}var Fe=i=>`video:meta:${i}`,J=i=>`video:blob:${i}`,Ae=(()=>{let a=class a{has(t){return C(this,null,function*(){return!!(yield ce(J(t)))})}blobUrl(t){return C(this,null,function*(){let e=yield ce(J(t));return e?URL.createObjectURL(e):""})}preload(t,e){return C(this,null,function*(){if(yield this.has(t))return;let o=yield fetch(e,{redirect:"follow"});if(!o.ok)throw new Error(`HTTP ${o.status}`);let r=yield o.blob();yield le(J(t),r),yield le(Fe(t),{mime:o.headers.get("content-type")||"video/mp4",size:r.size,savedAt:Date.now()})})}purge(t){return C(this,null,function*(){yield se(J(t)),yield se(Fe(t))})}};a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=me({token:a,factory:a.\u0275fac,providedIn:"root"});let i=a;return i})();var He=["videoPlayer"],Le=(()=>{let a=class a{constructor(t,e,o,r,_,g){this.scrollService=t,this.statusBarService=e,this.modalCtrl=o,this.storageService=r,this.authService=_,this.videoCache=g,this.duration=0,this.watchedSeconds=[],this.lastTime=0,this.lastContinuousStart=0,this.seeking=!1,this.completionFired=!1,this.CONT_END_TAIL=1,this.CONT_REQUIRED=5,this.MAX_JUMP_FOR_CONT=1.25,this.playSrc=""}ngOnInit(){return C(this,null,function*(){var o;if(!((o=this.item)!=null&&o.video))return;let t=this.item.video,e=`${be.apiBaseUrl}/video/${t}`;if(yield this.videoCache.has(t)){let r=yield this.videoCache.blobUrl(t);this.playSrc=r,this.revokeUrl=()=>URL.revokeObjectURL(r)}else this.playSrc=e,this.videoCache.preload(t,e).then(()=>C(this,null,function*(){var _,g,w;let r=yield this.videoCache.blobUrl(t);if(r){let k=(g=(_=this.videoPlayer)==null?void 0:_.vid)==null?void 0:g.nativeElement,X=!!(k&&!k.paused);this.playSrc=r,(w=this.revokeUrl)==null||w.call(this),this.revokeUrl=()=>URL.revokeObjectURL(r)}})).catch(r=>console.warn("Preload failed:",r))})}ionViewWillEnter(){this.initializeStatusBar()}ionViewWillLeave(){this.statusBarService.modifyStatusBar(b.Light)}close(){return C(this,null,function*(){var e;let t=yield this.modalCtrl.getTop();yield t==null?void 0:t.dismiss({}),(e=this.revokeUrl)==null||e.call(this)})}initializeStatusBar(){this.statusBarService.show(!0),this.statusBarService.modifyStatusBar(b.Dark),this.statusBarService.overLay(!1)}onCanPlay(){var t,e,o;(o=(e=(t=this.videoPlayer)==null?void 0:t.vid)==null?void 0:e.nativeElement)==null||o.play().catch(()=>{})}onError(t){console.error("video error",t)}onMeta(){var o,r;let t=(r=(o=this.videoPlayer)==null?void 0:o.vid)==null?void 0:r.nativeElement;if(!t)return;this.duration=Number.isFinite(t.duration)?t.duration:0;let e=Math.max(1,Math.ceil(this.duration||0));this.watchedSeconds=new Array(e).fill(!1),this.lastTime=0,this.lastContinuousStart=0,this.completionFired=!1}onTimeUpdate(){var g,w;let t=(w=(g=this.videoPlayer)==null?void 0:g.vid)==null?void 0:w.nativeElement;if(!t||!this.duration)return;let e=t.currentTime,o=Math.floor(e);o>=0&&o<this.watchedSeconds.length&&(this.watchedSeconds[o]=!0),!this.completionFired&&e<this.lastTime&&this.lastTime>=this.duration-this.CONT_END_TAIL&&this.markAttemptedEnd("loop-wrap"),(Math.abs(e-this.lastTime)>this.MAX_JUMP_FOR_CONT||this.seeking)&&(this.lastContinuousStart=e);let r=e>=this.duration-this.CONT_END_TAIL,_=e-this.lastContinuousStart;!this.completionFired&&r&&_>=this.CONT_REQUIRED&&this.markAttemptedEnd("tail-reached-continuous"),this.lastTime=e}onSeeking(){this.seeking=!0}onSeeked(){var e,o;let t=(o=(e=this.videoPlayer)==null?void 0:e.vid)==null?void 0:o.nativeElement;this.seeking=!1,t&&(this.lastContinuousStart=t.currentTime)}onRateChange(){var e,o,r,_,g;((_=(r=(o=(e=this.videoPlayer)==null?void 0:e.vid)==null?void 0:o.nativeElement)==null?void 0:r.playbackRate)!=null?_:1)>2&&!this.completionFired&&(this.lastContinuousStart=(g=this.videoPlayer)==null?void 0:g.vid.nativeElement.currentTime)}onEnded(){this.completionFired||this.markAttemptedEnd("native-ended")}markAttemptedEnd(t){var o,r;this.completionFired=!0;let e={itemId:(r=(o=this.item)==null?void 0:o.video)!=null?r:null,reason:t,duration:this.duration,watchedPercent:this.watchedPercent(),watchedSeconds:this.countWatchedSeconds(),timestamp:Date.now()};console.log("Video completion (attempt) logged:",e),this.logCompleted()}watchedPercent(){if(!this.duration||!this.watchedSeconds.length)return 0;let t=this.watchedSeconds.reduce((e,o)=>e+(o?1:0),0);return Math.min(100,t/this.watchedSeconds.length*100)}countWatchedSeconds(){return this.watchedSeconds.reduce((t,e)=>t+(e?1:0),0)}logCompleted(){var o,r,_,g,w,k,X;let t=Be((o=this.category)==null?void 0:o.slug,(r=this.item)==null?void 0:r.slug),e=(w=((g=(_=this.currentProfile)==null?void 0:_.progress)==null?void 0:g.lessons).compeleted)!=null?w:[];e.includes(t)||e.push(t),((X=(k=this.currentProfile)==null?void 0:k.progress)==null?void 0:X.lessons).compeleted=e,this.storageService.saveProfile(this.currentProfile),this.authService.setCurrentLogin(this.currentProfile)}};a.\u0275fac=function(e){return new(e||a)(y(K),y(H),y(z),y(Q),y(ke),y(Ae))},a.\u0275cmp=E({type:a,selectors:[["app-video-player-modal"]],viewQuery:function(e,o){if(e&1&&T(He,7),e&2){let r;V(r=B())&&(o.videoPlayer=r.first)}},decls:12,vars:5,consts:[["videoPlayer",""],[3,"translucent"],["color","dark"],["slot","start"],[3,"click"],["name","arrow-back","slot","icon-only"],[2,"text-align","center"],["slot","end",2,"width","48px"],[1,"viewer",3,"fullscreen"],[3,"loadedmetadata","canplay","playing","timeupdate","seeking","seeked","ratechange","ended","src","fullHeight"],[1,"no-shadow","modal-safe-botom"]],template:function(e,o){if(e&1){let r=I();c(0,"ion-header",1)(1,"ion-toolbar",2)(2,"ion-buttons",3)(3,"ion-button",4),x("click",function(){return p(r),h(o.close())}),u(4,"ion-icon",5),l()(),c(5,"ion-title",6),v(6),l(),u(7,"div",7),l()(),c(8,"ion-content",8)(9,"app-video-player",9,0),x("loadedmetadata",function(){return p(r),h(o.onMeta())})("canplay",function(){return p(r),h(o.onCanPlay())})("playing",function(){return p(r),h(o.onCanPlay())})("timeupdate",function(){return p(r),h(o.onTimeUpdate())})("seeking",function(){return p(r),h(o.onSeeking())})("seeked",function(){return p(r),h(o.onSeeked())})("ratechange",function(){return p(r),h(o.onRateChange())})("ended",function(){return p(r),h(o.onEnded())}),l()(),u(11,"ion-footer",10)}e&2&&(m("translucent",!0),s(6),M(o.item==null?null:o.item.name),s(2),m("fullscreen",!0),s(),m("src",o.playSrc)("fullHeight",!0))},dependencies:[O,R,U,$,j,F,A,D,N,L,je],styles:[".viewer[_ngcontent-%COMP%]{--background: #000;background:#000}ion-footer[_ngcontent-%COMP%]{background:#000}.player[_ngcontent-%COMP%]{height:100%!important}"]});let i=a;return i})();var Ke=i=>({"no-shadow":i});function We(i,a){if(i&1&&(P(0),v(1),S()),i&2){let n=a.ngIf;s(),M(n.category)}}function Ge(i,a){i&1&&u(0,"ion-icon",18)}function Je(i,a){if(i&1){let n=I();P(0),c(1,"div",11),x("click",function(){let e=p(n).$implicit,o=d(3).ngIf,r=d();return h(r.onShowVideoPlayer(e,o))}),c(2,"ion-card"),u(3,"img",12),l(),c(4,"div",13)(5,"h4",14),v(6),l(),c(7,"ion-button",15),u(8,"ion-icon",16),l()(),f(9,Ge,1,0,"ion-icon",17),l(),S()}if(i&2){let n=a.$implicit,t=d(3).ngIf,e=d();s(3),ge("alt",n.name),m("src",n.image,ue),s(3),M(n.name),s(3),m("ngIf",e.isItemDone(t.slug,n.slug))}}function Xe(i,a){if(i&1&&(c(0,"div",8),f(1,Je,10,4,"ng-container",10),l()),i&2){let n=d(2).ngIf;s(),m("ngForOf",n.items)}}function Ye(i,a){if(i&1&&u(0,"ion-icon",22),i&2){let n=d().$implicit;m("color",(n==null?null:n.slug)!=="white"?"light":"dark")}}function Ze(i,a){i&1&&(c(0,"ion-button",20),u(1,"ion-icon",16),l())}function qe(i,a){i&1&&(c(0,"ion-button",21),u(1,"ion-icon",16),l())}function et(i,a){if(i&1){let n=I();P(0),c(1,"div",11),x("click",function(){let e=p(n).$implicit,o=d(3).ngIf,r=d();return h(r.onShowVideoPlayer(e,o))}),c(2,"ion-card")(3,"ion-card-content")(4,"ion-card-title"),v(5),f(6,Ye,1,1,"ion-icon",19),l(),f(7,Ze,2,0,"ion-button",20)(8,qe,2,0,"ion-button",21),l()()(),S()}if(i&2){let n=a.$implicit,t=d(3).ngIf,e=d();s(3),ee("background-color: ",n.backgroundColor,";"),s(),ee("color: ",n.fontColor,";"),s(),te("",n.name," "),s(),m("ngIf",e.isItemDone(t.slug,n.slug)),s(),Z((n==null?null:n.slug)!=="white"?7:8)}}function tt(i,a){if(i&1&&(c(0,"div",9),f(1,et,9,9,"ng-container",10),l()),i&2){let n=d(2).ngIf;s(),m("ngForOf",n.items)}}function nt(i,a){i&1&&u(0,"ion-icon",18)}function it(i,a){if(i&1){let n=I();P(0),c(1,"div",11),x("click",function(){let e=p(n).$implicit,o=d(3).ngIf,r=d();return h(r.onShowVideoPlayer(e,o))}),c(2,"ion-card")(3,"ion-card-content")(4,"span",23),v(5),l(),f(6,nt,1,0,"ion-icon",17),l()(),c(7,"div",24)(8,"h4",14),v(9),l(),c(10,"ion-button",15),u(11,"ion-icon",16),l()()(),S()}if(i&2){let n=a.$implicit,t=d(3).ngIf,e=d();s(5),M(n==null?null:n.content),s(),m("ngIf",e.isItemDone(t.slug,n.slug)),s(3),M(n.name)}}function ot(i,a){if(i&1&&(c(0,"div",8),f(1,it,12,3,"ng-container",10),l()),i&2){let n=d(2).ngIf;s(),m("ngForOf",n.items)}}function rt(i,a){i&1&&u(0,"ion-icon",18)}function at(i,a){if(i&1){let n=I();P(0),c(1,"div",11),x("click",function(){let e=p(n).$implicit,o=d(3).ngIf,r=d();return h(r.onShowVideoPlayer(e,o))}),c(2,"ion-card")(3,"ion-card-content")(4,"ion-card-title"),v(5),f(6,rt,1,0,"ion-icon",17),l(),c(7,"ion-button",15),u(8,"ion-icon",16),l()()()(),S()}if(i&2){let n=a.$implicit,t=d(3).ngIf,e=d();s(5),te("",n.name," "),s(),m("ngIf",e.isItemDone(t.slug,n.slug))}}function ct(i,a){if(i&1&&(c(0,"div",9),f(1,at,9,2,"ng-container",10),l()),i&2){let n=d(2).ngIf;s(),m("ngForOf",n.items)}}function lt(i,a){if(i&1&&(P(0),f(1,Xe,2,1,"div",8)(2,tt,2,1,"div",9)(3,ot,2,1,"div",8)(4,ct,2,1,"div",9),S()),i&2){let n=d().ngIf;s(),Z((n==null?null:n.slug)==="animals"||(n==null?null:n.slug)==="countries"||(n==null?null:n.slug)==="health-and-safety"||(n==null?null:n.slug)==="seasons"||(n==null?null:n.slug)==="sports"||(n==null?null:n.slug)==="household-items"||(n==null?null:n.slug)==="countries"?1:(n==null?null:n.slug)==="color"?2:(n==null?null:n.slug)==="emotions"||(n==null?null:n.slug)==="places-n-directions"||(n==null?null:n.slug)==="relationships"?3:4)}}function st(i,a){if(i&1&&(P(0),f(1,lt,5,1,"ng-container",5),S()),i&2){let n=a.ngIf;d();let t=q(13);s(),m("ngIf",n==null||n.items==null?null:n.items.length)("ngIfElse",t)}}function dt(i,a){i&1&&(c(0,"p"),v(1,"Loading\u2026"),l())}function _t(i,a){i&1&&(c(0,"p"),v(1,"No items yet for this category."),l())}var Kt=(()=>{let a=class a{constructor(t,e,o,r,_,g){this.scrollService=t,this.statusBarService=e,this.storageService=o,this.lessonsService=r,this.modalCtrl=_,this.domSanitizer=g,this.route=Y(we),this.lessons=Y(W),this.showShadow=!1,this.current="",Oe({arrowBack:Ee,play:Ve,checkmarkCircle:Te}),this.scrollService.scrollTop$.subscribe(w=>this.showShadow=w>0)}ngOnInit(){return C(this,null,function*(){this.currentProfile=yield this.storageService.getSavedProfile(),this.category$=this.route.paramMap.pipe(de(t=>t.get("category")||""),_e(t=>(this.current=t,this.lessons.getCategory(t))))})}ngAfterViewInit(){this.initializeStatusBar(),this.scrollService.register(this.content)}ionViewWillEnter(){this.initializeStatusBar()}isItemDone(t,e){return this.lessonsService.isItemDone(this.currentProfile||void 0,t,e)}onShowVideoPlayer(t,e){return C(this,null,function*(){let o=yield this.modalCtrl.create({component:Le,cssClass:"modal-fullscreen",backdropDismiss:!1,canDismiss:!0,componentProps:{item:t,category:e,currentProfile:this.currentProfile}});yield o.present(),o.onDidDismiss().then(r=>{this.statusBarService.modifyStatusBar(b.Light)})})}initializeStatusBar(){this.statusBarService.show(!0),this.statusBarService.modifyStatusBar(b.Light),this.statusBarService.overLay(!1)}};a.\u0275fac=function(e){return new(e||a)(y(K),y(H),y(Q),y(W),y(z),y(ve))},a.\u0275cmp=E({type:a,selectors:[["app-category"]],viewQuery:function(e,o){if(e&1&&T(O,7),e&2){let r;V(r=B())&&(o.content=r.first)}},decls:15,vars:12,consts:[["loading",""],["empty",""],[3,"translucent","ngClass"],["slot","start"],["default-href","/lessons"],[4,"ngIf","ngIfElse"],[1,"ion-padding","modal-safe-botom"],[1,"no-shadow","modal-safe-botom"],[1,"cards","grid"],[1,"cards","list"],[4,"ngFor","ngForOf"],[1,"card-holder",3,"click"],[3,"src","alt"],[1,"card-action","animals"],[1,"card-title"],["shape","round"],["name","play","slot","icon-only"],["color","success","size","large","name","checkmark-circle","class","done",4,"ngIf"],["color","success","size","large","name","checkmark-circle",1,"done"],["size","large","name","checkmark-circle","class","done",3,"color",4,"ngIf"],["shape","round","color","light","fill","outline"],["shape","round","color","dark","fill","outline"],["size","large","name","checkmark-circle",1,"done",3,"color"],[1,"emoji"],[1,"card-action","emotions"]],template:function(e,o){if(e&1&&(c(0,"ion-header",2)(1,"ion-toolbar")(2,"ion-buttons",3),u(3,"ion-back-button",4),l(),c(4,"ion-title"),f(5,We,2,1,"ng-container",5),ne(6,"async"),l()()(),c(7,"ion-content",6),f(8,st,2,2,"ng-container",5),ne(9,"async"),f(10,dt,2,0,"ng-template",null,0,oe)(12,_t,2,0,"ng-template",null,1,oe),l(),u(14,"ion-footer",7)),e&2){let r=q(11);m("translucent",!0)("ngClass",pe(10,Ke,!o.showShadow)),s(5),m("ngIf",ie(6,6,o.category$))("ngIfElse",r),s(3),m("ngIf",ie(9,8,o.category$))("ngIfElse",r)}},dependencies:[j,he,fe,ye,Ce,F,Pe,O,$,A,D,N,U,R,Se,L,xe,Ie,Me],styles:[".cards[_ngcontent-%COMP%]{gap:10px}.cards.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr)}.cards.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]{text-align:center;position:relative}.cards.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{height:240px;pointer-events:none}.cards.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:0!important;display:flex;flex-direction:column;align-items:center;justify-content:center}.cards.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   .card-action[_ngcontent-%COMP%]{display:flex;justify-content:space-between;position:absolute;width:100%;padding-left:10px;padding-right:10px;align-items:center}.cards.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   .card-action.animals[_ngcontent-%COMP%]{flex-direction:row;background-color:#00000047;bottom:0;color:#fff}.cards.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   .card-action.emotions[_ngcontent-%COMP%]{flex-direction:column;top:0;height:100%;padding-bottom:10px}.cards.list[_ngcontent-%COMP%]{display:flex;flex-direction:column}.cards.list[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding-left:30px;padding-right:30px;display:flex;flex-direction:row;align-items:center;justify-content:space-between}.cards.list[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;gap:10px}.card-holder[_ngcontent-%COMP%]{width:100%;display:inline-block;transition:transform .15s ease-in-out;cursor:pointer;overflow:hidden;border-radius:12px;box-shadow:0 8px 16px #00000014,0 0 4px #0000000a!important}.card-holder[_ngcontent-%COMP%]:active{transform:scale(.95)}ion-card[_ngcontent-%COMP%]{width:100%;margin:0!important;--background: transparent;background:transparent;border:none!important;box-shadow:none}ion-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-position:center;object-fit:cover}ion-card-content[_ngcontent-%COMP%]{width:100%;height:100%}ion-card-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.card-title[_ngcontent-%COMP%]{margin-top:10px!important;margin-bottom:10px!important}.emoji[_ngcontent-%COMP%]{font-size:5rem}.grid[_ngcontent-%COMP%]   .card-holder[_ngcontent-%COMP%]   .done[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;background:#fff;border-radius:50%}"]});let i=a;return i})();export{Kt as CategoryPage};
